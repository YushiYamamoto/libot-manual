import{bR as F,d as Q,r as p,g as M,f as W,bS as ce,o as V,c as $,b as l,w as a,k as C,A as O,a as k,bA as J,bz as X,bK as L,by as P,bT as oe,bU as se,bB as Y,q as G,p as Z,t as ee,v as le,bP as ue,bQ as re,E as te,bL as ae,bC as ne,bJ as pe,bV as me,z as H,bW as _e,bX as ve,m as de,bH as fe,_ as ge,bY as be,bN as ye}from"./index-dBFwtZvD.js";import{a as ie,p as he}from"./overlay-XAJimKsD.js";/* empty css                 *//* empty css                */const Ve=b=>F({url:"/roles",method:"get",params:b}),we=b=>F({url:`/roles/${b}`,method:"delete"}),ke=b=>F({url:`/roles/${b}`,method:"get"}),Ce=(b,D)=>F({url:`/roles/${b}`,method:"put",data:D}),xe=b=>F({url:"/roles",method:"post",data:b}),Ee=()=>F({url:"/permission",method:"get"}),Re={class:""},Se=Q({__name:"DataAuthTable",props:{title:{default:"分配数据权限"},permisstionIds:{}},emits:["update:permisstionIds"],setup(b,{expose:D,emit:d}){const v=()=>({group_name:[],name:""}),N=b,E=d,i=p(v()),o=p([]),y=p([]),A=p(),f=M({get(){return N.permisstionIds},set(e){E("update:permisstionIds",e)}}),h=p(!1),R=M(()=>{const e=o.value.map(t=>t.group_name);return Array.from(new Set(e))}),T=()=>{y.value=o.value.filter(e=>{let t=!0,n=!0;const s=new RegExp(i.value.name);return i.value.name&&(t=s.test(e.name)),i.value.group_name.length&&(n=i.value.group_name.includes(e.group_name)),t&&n}),c()},I=()=>{i.value=v(),y.value=oe(o.value),c()},m=async()=>{try{h.value=!0;const{status:e,data:t}=await Ee();e===200&&(o.value=oe(t),I())}finally{h.value=!1}},c=()=>{se(()=>{y.value.forEach(e=>{var t;f.value.includes(e.id)&&((t=A.value)==null||t.toggleRowSelection(e,!0))})})},z=(e,t)=>{const n=f.value.findIndex(s=>s===t.id);n>=0?f.value.splice(n,1):f.value.push(t.id)},S=e=>{if(e.length){const t=e.map(n=>n.id);f.value=[...new Set([...f.value,...t])]}else y.value.forEach(t=>{const n=f.value.findIndex(s=>s===t.id);n>=0&&f.value.splice(n,1)})},K=({row:e,rowIndex:t,columnIndex:n})=>{if(n===1){const s=y.value[t-1];let g=y.value[t+1],w=1;if(!s||s.group_name!==e.group_name){for(;g&&g.group_name===e.group_name;)w++,g=y.value[t+w];return{rowspan:w,colspan:1}}else return{rowspan:0,colspan:0}}},_=()=>{i.value=v(),y.value=[]};return W(()=>{m()}),ce(()=>{_()}),D({init:m,reset:I,empty:_}),(e,t)=>{const n=ne,s=Y,g=G,w=Z,B=ee,u=le,U=ue,j=re,q=te,r=ae;return V(),$("div",Re,[l(q,null,{header:a(()=>[C(O(e.title),1)]),default:a(()=>[k("div",null,[l(u,{model:i.value,inline:!0},{default:a(()=>[l(g,{label:"权限分组",prop:"group_name"},{default:a(()=>[l(s,{modelValue:i.value.group_name,"onUpdate:modelValue":t[0]||(t[0]=x=>i.value.group_name=x),multiple:!0,clearable:!0},{default:a(()=>[(V(!0),$(J,null,X(R.value,x=>(V(),P(n,{key:x,value:x,label:x},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(g,{label:"权限名称",prop:"name"},{default:a(()=>[l(w,{modelValue:i.value.name,"onUpdate:modelValue":t[1]||(t[1]=x=>i.value.name=x),clearable:!0},null,8,["modelValue"])]),_:1}),l(g,null,{default:a(()=>[l(B,{type:"primary",onClick:T},{default:a(()=>[C("查询")]),_:1}),l(B,{type:"danger",onClick:I},{default:a(()=>[C("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),L((V(),P(j,{ref_key:"tableVNode",ref:A,data:y.value,"span-method":K,"max-height":"630",border:"",onSelect:z,onSelectAll:S},{default:a(()=>[l(U,{type:"selection",width:"55",align:"center"}),l(U,{align:"center",label:"权限分组",prop:"group_name"}),l(U,{label:"权限名称",prop:"name"})]),_:1},8,["data"])),[[r,h.value]])]),_:1})])}}}),ze={class:"d-flex justify-space-between"},Ue={class:"role-editor-container"},Ne={class:"role-editor__left"},Te={class:"fs-14"},Ie={key:0,class:"color--warning pr-4"},$e=["title"],De={class:"role-editor__right"},Ae=Q({__name:"RoleEditor",props:{modelValue:{type:Boolean,default:!1},editingRow:{}},emits:["update:modelValue","success"],setup(b,{emit:D}){const d=()=>({name:"",description:"",type:0,order:0,permissions:[],resources:[]}),v=b,N=D,E=M({get(){return v.modelValue},set(_){N("update:modelValue",_)}}),i=p(),o=p(d()),y={name:[{required:!0,message:"请输入角色名称"}],type:[{required:!0,message:"请选择角色类型"}]},A=pe(),f=p([]),h=p(!1),R=p(),T=p(),I=async()=>{try{h.value=!0,f.value=await A.allResources()}finally{h.value=!1}},m=p(!1),c=async()=>{var _,e,t;try{if(m.value=!0,(_=v.editingRow)!=null&&_.id){const{status:n,data:s}=await ke(v.editingRow.id);n===200&&(o.value=Object.assign(d(),s),o.value.resources.forEach(g=>{var w;(w=R.value)==null||w.setChecked(g,!0,!1)}))}else o.value=d(),(e=R.value)==null||e.setCheckedKeys([]),(t=T.value)==null||t.empty();se(()=>{var n;(n=T.value)==null||n.init()})}finally{m.value=!1}},z=()=>{var t,n;const _=((t=R.value)==null?void 0:t.getCheckedKeys())||[],e=((n=R.value)==null?void 0:n.getHalfCheckedKeys())||[];return _.concat(e)},S=p(!1),K=()=>{var _;(_=i.value)==null||_.validate(async e=>{var t;if(e)try{S.value=!0,o.value.resources=z();let n;(t=v.editingRow)!=null&&t.id?n=await Ce(v.editingRow.id,o.value):n=await xe(o.value);const{status:s,data:g}=n;s===200&&(de.success("操作成功!"),E.value=!1,N("success",g))}finally{S.value=!1}})};return W(()=>{I()}),(_,e)=>{const t=ee,n=Z,s=G,g=ne,w=Y,B=fe,u=le,U=te,j=me,q=ae;return V(),P(j,{modelValue:E.value,"onUpdate:modelValue":e[6]||(e[6]=r=>E.value=r),"show-close":!1,direction:"rtl",size:"90%",onOpened:c},{header:a(()=>[k("div",ze,[k("div",null,O(_.editingRow?"编辑角色":"新增角色"),1),k("div",null,[l(t,{type:"primary",loading:S.value,onClick:K},{default:a(()=>[C("提交")]),_:1},8,["loading"]),l(t,{type:"danger",onClick:e[0]||(e[0]=r=>E.value=!1)},{default:a(()=>[C("关闭")]),_:1})])])]),default:a(()=>[k("div",Ue,[k("div",Ne,[l(U,{class:"mb-16"},{header:a(()=>[C("角色基础信息")]),default:a(()=>[l(u,{ref_key:"formVNode",ref:i,model:o.value,rules:y,"label-width":"90px"},{default:a(()=>[l(s,{label:"角色名称",prop:"name"},{default:a(()=>[l(n,{modelValue:o.value.name,"onUpdate:modelValue":e[1]||(e[1]=r=>o.value.name=r),maxlength:60,"show-word-limit":!0},null,8,["modelValue"])]),_:1}),l(s,{label:"角色类型",prop:"type"},{default:a(()=>[l(w,{modelValue:o.value.type,"onUpdate:modelValue":e[2]||(e[2]=r=>o.value.type=r),style:{width:"100%"}},{default:a(()=>[(V(!0),$(J,null,X(H(ie),r=>(V(),P(g,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"排序",prop:"order"},{default:a(()=>[l(B,{modelValue:o.value.order,"onUpdate:modelValue":e[3]||(e[3]=r=>o.value.order=r),style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(s,{label:"角色描述",prop:"description"},{default:a(()=>[l(n,{modelValue:o.value.description,"onUpdate:modelValue":e[4]||(e[4]=r=>o.value.description=r),maxlength:200},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),l(U,null,{header:a(()=>[C("分配菜单权限")]),default:a(()=>[L((V(),$("div",null,[L((V(),P(H(_e),{ref_key:"resourceTreeVNode",ref:R,data:f.value,props:{label:"name",children:"sub"},"show-checkbox":"","default-expand-all":!1,"expand-on-click-node":!1,"highlight-current":"","node-key":"id"},{default:a(({node:r,data:x})=>[k("div",Te,[x.type===3?(V(),$("span",Ie,"[页面级]")):ve("",!0),k("span",{title:x.id},O(r.label),9,$e)])]),_:1},8,["data"])),[[q,h.value]])])),[[q,h.value]])]),_:1})]),k("div",De,[l(Se,{ref_key:"dataAuthTableVNode",ref:T,"permisstion-ids":o.value.permissions,"onUpdate:permisstionIds":e[5]||(e[5]=r=>o.value.permissions=r)},null,8,["permisstion-ids"])])])]),_:1},8,["modelValue"])}}}),Be=ge(Ae,[["__scopeId","data-v-d9727c7a"]]),Pe={class:"view-container"},Fe={class:"d-flex justify-end"},Ke={class:"d-flex justify-end py-16"},Oe=Q({name:"SystemRole",__name:"index",setup(b){const d=p({name:"",type:"",page:1,page_size:10}),v=p(!1),N=p(0),E=p([]),i=async()=>{try{v.value=!0;const m=he(d.value),{status:c,data:z}=await Ve(m);c===200&&(E.value=z.data,N.value=z.total)}finally{v.value=!1}},o=()=>{d.value.page=1,i()},y=m=>{d.value.page=m,i()},A=m=>{d.value.page_size=m,i()},f=p(null),h=p(!1),R=()=>{h.value=!0,f.value=null},T=m=>{h.value=!0,f.value=m},I=m=>{ye.confirm("确定要删除吗?",{title:"温馨提示"}).then(async()=>{try{v.value=!0;const{status:c}=await we(m.id);c===200&&(de.success("删除成功!"),o())}finally{v.value=!1}})};return W(()=>{o()}),(m,c)=>{const z=Z,S=G,K=ne,_=Y,e=ee,t=le,n=te,s=ue,g=re,w=be,B=ae;return L((V(),$("div",Pe,[l(n,{class:"mb-16"},{default:a(()=>[l(t,{model:d.value,inline:!0},{default:a(()=>[l(S,{label:"角色名称",prop:"name"},{default:a(()=>[l(z,{modelValue:d.value.name,"onUpdate:modelValue":c[0]||(c[0]=u=>d.value.name=u)},null,8,["modelValue"])]),_:1}),l(S,{label:"角色类型",prop:"type"},{default:a(()=>[l(_,{modelValue:d.value.type,"onUpdate:modelValue":c[1]||(c[1]=u=>d.value.type=u)},{default:a(()=>[(V(!0),$(J,null,X(H(ie),u=>(V(),P(K,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(S,null,{default:a(()=>[l(e,{type:"primary",onClick:o},{default:a(()=>[C("查询")]),_:1})]),_:1})]),_:1},8,["model"]),k("div",Fe,[l(e,{type:"primary",onClick:R},{default:a(()=>[C("新增角色")]),_:1})])]),_:1}),l(n,null,{default:a(()=>[l(g,{data:E.value,"max-height":"650px",border:""},{default:a(()=>[l(s,{label:"序号",type:"index",align:"center",width:"100"}),l(s,{label:"角色ID",prop:"id",align:"center",width:"120"}),l(s,{label:"角色名称",prop:"name",align:"center",width:"180"}),l(s,{label:"角色描述",prop:"description",align:"center"}),l(s,{label:"操作",align:"center",width:"160"},{default:a(({row:u})=>[l(e,{type:"primary",size:"small",onClick:U=>T(u)},{default:a(()=>[C("编辑")]),_:2},1032,["onClick"]),l(e,{type:"danger",size:"small",plain:"",onClick:U=>I(u)},{default:a(()=>[C("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),k("div",Ke,[l(w,{"current-page":d.value.page,"onUpdate:currentPage":c[2]||(c[2]=u=>d.value.page=u),"page-size":d.value.page_size,"onUpdate:pageSize":c[3]||(c[3]=u=>d.value.page_size=u),total:N.value,layout:"total,sizes,pager",background:"",onCurrentChange:y,onSizeChange:A},null,8,["current-page","page-size","total"])]),l(Be,{modelValue:h.value,"onUpdate:modelValue":c[4]||(c[4]=u=>h.value=u),"editing-row":f.value,onSuccess:i},null,8,["modelValue","editing-row"])])),[[B,v.value]])}}});export{Oe as default};
